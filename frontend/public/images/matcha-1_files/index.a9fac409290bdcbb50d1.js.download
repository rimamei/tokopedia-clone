window.datalayerClientWeb=function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";t.r(n),t.d(n,"initializeGTM",(function(){return u})),t.d(n,"initializeGTMWithIris",(function(){return P})),t.d(n,"initializeIris",(function(){return _}));const o=e=>e instanceof Array,r=e=>"function"==typeof e,i=(e,n,t)=>{if(t&&t.debug){let r=o(n)?n:[n];t&&t.style&&(r=[`%c ${[n].join(" ")}`,t.style]),console[e](...r)}return!0},s=[["domainHash","string"],["uuid","string"],["initialVisit","number"],["beginningPrev","number"],["beginningCurr","number"],["counter","number"]],a=(e,n)=>!(!window||!document||window.pollingDone)&&(r(n)?(e.map(e=>n([],e)),window.pollingDone=!0):o(n)&&n.forEach(n=>{r(n)&&(e.map(e=>n([],e)),window.pollingDone=!0)}),!0),c=(e,n)=>{const{push:t}=window[e];window[e].push=(...o)=>{try{t(...o)}catch(e){console.log("error: ",e)}"function"==typeof n?(a(window[e],n),n(window[e],...o)):n instanceof Array&&n.forEach(n=>{r(n)&&(a(window[e],n),n(window[e],...o))})}};var u=(e="dataLayer",n,t="GTM-TN8CNF")=>{var o,r;if(window&&document&&!window.init_iris_new){let s=!1;const a=document.getElementsByTagName("script");for(let e=0;e<a.length;e++)if(null===(r=null===(o=a[e])||void 0===o?void 0:o.src)||void 0===r?void 0:r.includes(`www.googletagmanager.com/gtm.js?id=${t}`)){s=!0;break}try{if(window[e]=window[e]||[],s)c(e,n);else{const o=document.getElementsByTagName("script")[0],r=document.createElement("script"),i="dataLayer"!==e?`&l=${e}`:"";r.async=!0,r.src=`//www.googletagmanager.com/gtm.js?id=${t}${i}`,n&&r.addEventListener("load",()=>{c(e,n),n||window[e].push({"gtm.start":(new Date).getTime(),event:"gtm.js"})}),o.parentNode.insertBefore(r,o)}return window.init_iris_new=!0,!0}catch(e){return i("error","[GTM] Error Initializing GTM"),i("error",e),!1}}return i("warn","[GTM] Warning! window or document object not found"),!1};const d=Boolean("undefined"!=typeof window&&window.document&&window.document.createElement),l=e=>{if(!e)return null;if(!d||!document||!document.cookie)return null;const n=encodeURIComponent(e).replace(/[-.+*]/g,"\\$&"),t=new RegExp(`(?:(?:^|.*;)\\s*${n}\\s*\\=\\s*([^;]*).*$)|^.*$`);return decodeURIComponent(document.cookie.replace(t,"$1"))||null};var m=function(e,n){return n=n||{},new Promise((function(t,o){var r=new XMLHttpRequest,i=[],s=[],a={},c=function(){return{ok:2==(r.status/100|0),statusText:r.statusText,status:r.status,url:r.responseURL,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(JSON.parse(r.responseText))},blob:function(){return Promise.resolve(new Blob([r.response]))},clone:c,headers:{keys:function(){return i},entries:function(){return s},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var u in r.open(n.method||"get",e,!0),r.onload=function(){r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,n,t){i.push(n=n.toLowerCase()),s.push([n,t]),a[n]=a[n]?a[n]+","+t:t})),t(c())},r.onerror=o,r.withCredentials="include"==n.credentials,n.headers)r.setRequestHeader(u,n.headers[u]);r.send(n.body||null)}))};const w=(e,n)=>"boolean"==typeof n||"number"==typeof n||null==n||"symbol"==typeof n?String(n):(o(n)&&n.forEach(e=>{w(void 0,e)}),n),f=e=>JSON.stringify(e,w);var g=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,a)}c((o=o.apply(e,n||[])).next())}))};var v=function({name:e,version:n,schemas:t}){return new Promise((o,r)=>{let i;const s=indexedDB.open(e,n);function a(e,n){return g(this,void 0,void 0,(function*(){const t=i.transaction([e],"readwrite").objectStore(e).add(n);return new Promise((e,o)=>{t.onerror=function(e){o(e)},t.onsuccess=function(){e(n)}})}))}function c(e){return g(this,void 0,void 0,(function*(){const n=i.transaction([e],"readonly").objectStore(e),t=yield n.getAll();return new Promise((e,n)=>{t.onerror=function(e){n(e)},t.onsuccess=function(){e(t.result)}})}))}function u(e){return g(this,void 0,void 0,(function*(){const n=i.transaction([e],"readwrite").objectStore(e),t=yield n.clear();return new Promise((e,n)=>{t.onerror=function(e){n(e)},t.onsuccess=function(){e(t.result)}})}))}function d(){i.close()}s.onupgradeneeded=function(e){i=e.target.result,t.forEach(e=>{i.objectStoreNames.contains(e)||i.createObjectStore(e,{keyPath:"id"})})},s.onsuccess=function(e){i=e.target.result,o({db:i,addItem:a,getItems:c,clear:u,close:d})},s.onerror=function(e){console.error(e),r(e)}})},p=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,a)}c((o=o.apply(e,n||[])).next())}))};const h=(()=>{let e,n=[];const t=e=>{let t;return t=m("https://hub.tokopedia.com/iris/v1/track/multi-event",Object.assign(Object.assign({},e),{method:"POST",body:f({data:n}),headers:{"Content-Type":"application/json"}})),n=[],t};return(o,r)=>{for(const e of n)if(e["gtm.uniqueEventId"]===o["gtm.uniqueEventId"])return Promise.resolve({});return n.push(o),e||(e=setTimeout(()=>(e=void 0,t(r)),2e3)),n.length>=5?(clearTimeout(e),e=void 0,t(r)):Promise.resolve({})}})();var b={trackIrisEvent:(e,n)=>m("https://hub.tokopedia.com/iris/v1/track/event",Object.assign(Object.assign({},n),{method:"POST",body:f({data:e}),headers:{"Content-Type":"application/json"}})).then(()=>{0}),trackIrisEventBatch:h,beaconDispatch:e=>{try{return navigator.sendBeacon("https://hub.tokopedia.com/iris/v1/track/event",JSON.stringify({data:e})),!0}catch(e){return console.error("[Failed Send Beacon]"),!1}return!0},backgroundSyncBatch:e=>p(void 0,void 0,void 0,(function*(){const n=yield v({name:"toped-iris-bgs",version:1,schemas:["iris-bgs-batch"]});if((yield n.getItems("iris-bgs-batch")).find(n=>JSON.parse(n.data)["gtm.uniqueEventId"]===e["gtm.uniqueEventId"]))return Promise.resolve({});const t=f(e),o=Math.floor(Math.random()*Math.floor(100));yield n.addItem("iris-bgs-batch",{id:Date.now()+"-"+o,data:t,endpoint:"https://hub.tokopedia.com/iris/v1/track/multi-event"});const r=yield navigator.serviceWorker.ready;try{yield r.sync.register("iris-bgs-sync-batch")}catch(n){console.warn("[Failed Background Sync]: "+n.message),h(e)}}))};const y=e=>btoa(e),x=()=>{let e="",n=4294967296*Math.random()>>>0;for(let t=0;t<32;t++){const o="xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx"[t-1],r=15&n,i="x"===o?r:3&r|8;e+="-"===o||"4"===o?o:i.toString(16),n=t%8==0?4294967296*Math.random()>>>0:n>>4}return e.toString()},S=e=>s.reduce((n,t)=>{const[o]=t;return n+=`.${e[o]}`},"").slice(1),j=(e,n,t)=>{const o=l("ISID"),r=o?JSON.parse(o):{};r[e]=n;try{0,(e=>{const{cname:n,cvalue:t,options:o}=e,r=Object.assign({domain:"tokopedia.com"},o);document.cookie=`${n}=${encodeURIComponent(t)}${Object.keys(r).map(e=>{return`;${n=e,n.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}=${r[e]}`;var n}).join("")};path=/`})({cname:"ISID",cvalue:JSON.stringify(r),options:t})}catch(e){return i("error",e),!1}return!0},I=(e,n)=>{const{sessionData:t}=(e=>{const n=l("ISID");let t,o,r;if(n){try{t=JSON.parse(n)}catch(e){i("error",e)}t&&t[e]&&(o={},r=t[e],r.split(".").forEach((e,n)=>{if(n<s.length){const[t,r]=s[n];switch(r){case"number":o[t]=parseInt(e,10);break;case"string":default:o[t]=e}}}))}return{sessionData:o,sessionString:r}})(e),{sessionString:o,sessionData:r}=((e,n,t)=>{const o=n&&n.currentTime?n.currentTime:(new Date).getTime();let r;e&&e.domainHash&&e.uuid&&e.initialVisit&&e.beginningCurr&&e.beginningPrev&&e.counter?(r=e,n&&n.increment?(r.domainHash=y(t),r.counter+=1):(r.domainHash=y(t),r.beginningPrev=r.beginningCurr,r.initialVisit=o,r.beginningCurr=o,r.uuid=x(),r.counter=1)):r={domainHash:y(t),uuid:x(),initialVisit:o,beginningPrev:o,beginningCurr:o,counter:1};const i=S(r);return{sessionData:r,sessionString:i}})(t,n,e);return window.irisSessionRaw=r,window.irisSession=o.split(".").slice(0,3).join("."),j(e,o,{domain:window.location.hostname,maxAge:n.maxAge})},O=e=>(I(e,{increment:!0,maxAge:31536e3}),window.addEventListener("beforeunload",()=>{(()=>{const e=window.location.hostname,n=window.irisSessionRaw,t=S(n);j(e,t,{domain:window.location.hostname,maxAge:31536e3})})()}),!0);var k=function(){return"undefined"!=typeof window&&"serviceWorker"in navigator&&"SyncManager"in window&&"indexedDB"in window},T=function(e,n){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)n.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(t[o[r]]=e[o[r]])}return t};var E=e=>(n,t)=>{try{let n;const s=(new Date).getTime();if("object"!=typeof(r=t)||o(r)||null===r)(e=>"string"==typeof e)(t)?(n={event:null,event_ga:null},e.customEventField?(n[e.customEventField]=t,n.event=e.defaultEventValue||"default_v2"):n.event=t):i("warn","[Iris Tracker] Iris tracker only accepts object or string!");else if(t.event){const{event:o}=t,r=T(t,["event"]);r["gtm.element"]&&(r["gtm.element"]=`${r["gtm.element"].id&&""!==r["gtm.element"].id?`#${r["gtm.element"].id}`:""}${r["gtm.element"].className&&""!==r["gtm.element"].className?`.${r["gtm.element"].className.replace(/\s/g,".")}`:""}`),n=r,e.customEventField?(n[e.customEventField]=o,n.event=e.defaultEventValue||"default_v2"):n.event=o}else i("warn","[Iris Tracker] Event pushed without event name, data will be rejected"),i("warn",t);if(n&&(e=>"string"==typeof e.event&&!e.event_ga.includes("gtm."))(n)){(e=>{const n=window.location.hostname,t=window.irisSessionRaw.beginningCurr,o=new Date(e),r=new Date(t),i=o.getDate()!==r.getDate(),s=e-t>=18e5;(i||s)&&I(n,{currentTime:e,maxAge:31536e3}),window.irisSessionRaw.beginningCurr=e})(s);const t=Object.assign(Object.assign(Object.assign({},n),{container:e.container,iris_session_id:window.irisSession,url:window.location.href,hits_time:s,userId:l("tuid"),deviceId:l("DID_JS"),version:"2.1.6"}),"performance_v2"===n.event_ga&&{event:n.event_ga});e.backgroundSync&&k()?b.backgroundSyncBatch(t):e.batching?b.trackIrisEventBatch(t):Boolean(navigator&&navigator.sendBeacon)?b.beaconDispatch(t):b.trackIrisEvent(t)}else 0;return!0}catch(e){return i("error","[Iris Tracker] PUSH event error"),i("error",e),!1}var r};const P=(e,n,t)=>{const{sessionName:o=window.location.hostname}=e;O(o),u(n,E(e),t)},_=(e,n="dataLayer",t)=>{if(window&&document&&!window.init_iris_new)try{const{sessionName:o=window.location.hostname}=e;if(O(o),window[n]=[],window[n].push=E(e),t){const{push:e}=window[n];window[n].push=(...o)=>{e(window[n],...o),"function"==typeof t?t(window[n],...o):t instanceof Array&&t.forEach(e=>{"function"==typeof e&&e(window[n],...o)})}}return window.init_iris_new=!0,!0}catch(e){return i("error","[Iris Tracker] Error initializing Iris instance"),i("error",e),!1}return i("error","[Iris Tracker] No window and document instance found"),!1}}]);
//# sourceMappingURL=index.a9fac409290bdcbb50d1.js.map